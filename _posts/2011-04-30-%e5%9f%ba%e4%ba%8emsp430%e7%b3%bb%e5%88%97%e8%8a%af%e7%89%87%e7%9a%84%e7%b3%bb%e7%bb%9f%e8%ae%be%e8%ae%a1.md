---
layout: post
title: 基于MSP430系列芯片的系统设计
date: 2011-04-30 01:10
author: tglgg821
comments: true
categories: [Techniques]
---
<p align="LEFT">一、序言</p>
<p align="LEFT">该系统的设计是我第一次用自己所学挣到钱的过程，所以对我来说有很特别的意义，而且说实话，正是从这个项目开始，我才算真正的开始了我的电子工程师的职业生涯。也算是创世纪吧。</p>
<p align="LEFT">二、概述</p>
<p align="LEFT">该项目的构成比较简单，前端通过一个涡轮式流量计发出脉冲信号，该脉冲信号经过运放放大之后送入MSP430芯片中，核心芯片经过计数脉冲的个数，根据流量计厂家提供的参数计算便可得出当前的流量，然后根据设定的值，通过后边的功率驱动板，输出驱动信号控制同步电机进行运转，同步电机则控制其后的减速机来调整阀门的大小，从而得到一个理想的流量。</p>
<p align="LEFT">这是一个完整的闭环控制系统，输入有脉冲信号，按键输入，输出有驱动输、出显示屏输出，与上位机有串行通信。</p>
<p align="LEFT">在后期的工作中，我又使用PIC的12F508单片机设计了一个红外线遥控器来控制该系统，并设计了一个上位机通过485协议与其进行通信。实现了一个上位机最多控制255个下位机的功能，当然，用在实际中最多只控制了一个房间，4至6个。再后来，通过与采购的成品无线通信链路连接，实现了5公里左右的无线通信功能。</p>
<p align="LEFT">三、电路设计</p>
<p align="LEFT">该板子的设计很简单，因为器件不多，采用了两层板的结构。下面从芯片选型开始。</p>
<p align="LEFT">核心的CPU芯片采用了TI的MSP430F135芯片，是个16位的单片机。软件上没有加操作系统，直接通过中断控制的。</p>
<p align="LEFT">输入5V电源，通过HT7333转换后，输出+3.3V电平，给单片机进行供电。</p>
<p align="LEFT">晶振采用了双晶振的模式，一个晶振是32768Hz，一个是4MHz的，这样可以实现低功耗运行，但是后来也没有用。</p>
<p align="LEFT">传感器输入的信号通过TLC27L2C差分放大，送入单片机。后来因为放大效果不好，更换为LM258。</p>
<p align="LEFT">430芯片通过两个数字IO口输出两个IO信号，然后用三极管2N5551放大后输出，以控制电机的正反转。</p>
<p align="LEFT">显示屏采用12864的LCD显示屏，输出8位数据进行控制。</p>
<p align="LEFT">后来去掉了一个按键，增加了一个可接收红外线的LED灯（光电管），产生脉冲信号，从而控制预设值的增减。</p>
<p align="LEFT">485芯片后来也有过更换，一种是RS485，一种是MAX485，记得MAX485好像效果更好些。</p>
<p align="LEFT">电路设计了三块板子，一块是主机板，一块是LCD显示屏和按键的背板，一块是功率驱动板。功率驱动板也很简单，就是用5V的IO输出控制两个固态继电器，但是固态继电器因为不抗雷击，所以在后边增加了两个抗雷击的电容。</p>
<p align="LEFT">四、经验总结</p>
<p align="LEFT">1、在运行一段时间后，系统有重启现象。经分析，应该是复位电路的设计有问题。按照芯片手册上修改RC复位电路后情况有所好转。</p>
<p align="LEFT">2、芯片的选型很重要，传感器脉冲输入信号的放大在更换了LM258之后也有所好转。</p>
<p align="LEFT">3、显示屏有花屏现象出现，分析可能是地线的影响，将其接到外部壳子上后，部分好转。</p>
<p align="LEFT"></p>
<p align="LEFT">五、改进建议</p>
<p align="LEFT">1、电源输入、3.3V输出和复位电路TI已经有一款芯片可以实现该功能，利尔达的售后推荐使用该芯片。</p>
<p align="LEFT">2、显示屏过于费电，而且价格较高，如果批量大的话可采用开模的方法降低成本，或可采用另外一款自己生成字库的屏。</p>
<p align="LEFT">3、利尔达的售后推荐使用其新款芯片，即MSP430F135的升级版本。据说其稳定性和可靠性会更高。</p>
<p align="LEFT">六、软件设计</p>
<p align="LEFT">1、使用无限循环的方式来执行程序。</p>
<p align="LEFT">2、使用外部中断信号来执行按键、遥控和通信程序。</p>
<p align="LEFT">3、对流量的显示采用加权的办法处理，使得显示更加平滑，稳定。</p>
<p align="LEFT">七、经验总结</p>
<p align="LEFT">1、因为对传感器特性的不清楚，以及没有很精确的计算程序运行指令的时序，故在一开始有流量不准的现象。</p>
<p align="LEFT">2、应该使用定时中断的方式来进行轮循，这样能保证流量显示的准确。</p>
